<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<link rel="shortcut icon" type="image/x-icon" href="../../images/ico.ico" media="screen" />
<title>留言板--放肆的青春诠释了悲伤</title>
<meta name="keywords" content="个人博客" />
<meta name="description" content="" />
<link rel="stylesheet" href="../../layui/css/layui.css">
<link rel="stylesheet" href="../../css/index.css"/>
<link rel="stylesheet" href="../../css/style.css"/>
<link rel="stylesheet" href="../../css/showPage/main.css">
    <!--表情 -->
<link rel="stylesheet" href="../../css/showPage/sinaFaceAndEffec.css">

<!--[if lt IE 9]>
<script src="js/html5.js"></script>
<![endif]-->
    <style>
        #c_right .s_about img{margin-left: 15px;}
        *{margin:0px;padding:0px;}
        #c_right .s_about p .b_1{margin-top: 0;}
        .clears{ clear:both;}
        /*messages*/
        .messages{padding:15px 0;}
        .messages input,.messages select,.messages textarea{margin:0;padding:0; background:none; border:0; font-family:"Microsoft Yahei";}
        .messlist {height:30px;margin-bottom:10px;}
        .messlist label{float:left;width:100px; height:30px; font-size:14px; line-height:30px; text-align:right;padding-right:10px;}
        .messlist input{float:left;width:300px;height:28px;padding-left:5px;border:#ccc 1px solid;}
        .messlist.textareas{ height:auto;}
        .messlist textarea{float:left;width:400px; height:110px;padding:5px;border:#ccc 1px solid;}
        .messlist.yzms input{width:100px;}
        .messlist.yzms .yzmimg{ float:left;margin-left:10px;}
        .messsub{padding:0px 0 0 110px;}
        .messsub input{width:100px; height:35px; background:#ddd; font-size:14px; font-weight:bold; cursor:pointer;margin-right:5px}
        .messsub input:hover{ background:#f60;color:#fff;}
        #label0{display:none;color:red;height:28px;line-height:28px;}
        #label1{display:none;color:#0aa770;height:28px;line-height:28px;}
        #label2{display:none;color:red;height:28px;line-height:28px;}
        #label3{display:none;color:#0aa770;height:28px;line-height:28px;}
        #label4{display:none;color:red;height:28px;line-height:28px;}
        #label5{display:none;color:red;height:28px;line-height:28px;}
        #label6{display:none;color:#0aa770;height:28px;line-height:28px;}
        #label7{display:none;color:red;height:28px;line-height:28px;}
        #label8{display:none;color:#0aa770;height:48px;line-height:48px;}
        #label9{display:none;color:red;height:48px;line-height:48px;}
        #label10{display:none;color:red;height:48px;line-height:48px;}
          /* 登录图标  */
        #qqLoginBtn img{margin: 0 auto;}
       
    </style>

</head>

<body>
      <!--header start-->
    <div id="header">
       <img id="headImgUrl" alt="img" src="../../images/welcome.png" width="300" height="50" style="margin-left: 350px">
       <p id="headSign">青春是打开了,就合不上的书。人生是踏上了，就回不了头的路，爱情是扔出了，就收不回的赌注。</p>    
    </div>
     <!--header end-->
    <!--nav-->
     <div id="nav">
         <ul>
             <li><a href="../../index.html">首页</a></li>
	         <li><a href="about.jsp">关于我</a></li>
	         <li><a href="learn.html">学海无涯</a></li>
	     <!--     <li><a href="dynamics.html">个人动态</a></li> -->
	         <li><a href="personalDiary.html">个人日记</a></li>
	         <li><a href="media.html">媒体展示</a></li>
	         <li><a href="message.html">留言板</a></li>
	         <div class="clear"></div>
        </ul>
      </div>
       <!--nav end-->
    <!--content start-->
    <div id="content">
       <!--left-->
         <div class="left" id="guestbook">
           <div class="weizi">
           <div class="wz_text">当前位置：<a href="../../index.html">首页</a>><h1>留言板</h1></div>
           </div>
                      <div class="g_content">
             <!--留言板区域-->
               <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                   <ul class="layui-tab-title">
                       <li class="layui-this">实名留言</li>
                       <li>匿名留言</li>
                   </ul>
                   <div class="layui-tab-content" style="height: 100px;">
                       <div class="layui-tab-item layui-show">
                           <div class="mail">

                               <div class="send">
                                   <div class="sendbox">
                                       <div  class="messagesBZ">
                                           备注：实名留言信息不会显示在下面的留言板区域，各位亲请放心留言哦，我会对大家的重要信息（如：手机号码，邮件等）做保密处理，谢谢你的关心。
                                       </div>
                                       <form method="get" class="messages">
                                           <div class="messlist">
                                               <label>姓名</label>
                                               <input type="text" placeholder="姓名" id="input1" onblur="jieshou()">
                                               <div id ="label0">*你还没填写名字呢!</div>
                                               <div id ="label1">√正确</div>
                                               <div id ="label2">×错误</div>
                                               <div class="clears"></div>
                                           </div>


                                           <div class="messlist">
                                               <label>电子邮件</label>
                                               <input type="text" placeholder="电子邮件" id="input2" onblur="mailtext()">
                                               <div id ="label3">√正确</div>
                                               <div id ="label4">×邮箱地址错误</div>
                                               <div id ="label5">*必填</div>
                                               <div class="clears"></div>
                                           </div>


                                           <div class="messlist">
                                               <label>手机号</label>
                                               <input type="text" placeholder="手机号" id="input3" onblur="phonetext()">
                                               <div id ="label6">√正确</div>
                                               <div id ="label7">×手机号码错误</div>
                                               <div class="clears"></div>
                                           </div>


                                           <div class="messlist textareas">
                                               <label>留言内容</label>
                                               <textarea placeholder="说点什么吧..." id="input4" onblur="content()"></textarea>
                                               <div id ="label8">√</div>
                                               <div id ="label9">×</div>
                                               <div id ="label10">* 必填</div>
                                               <div class="clears"></div>
                                           </div>


                                       <!--    <div class="messlist yzms">
                                               <label>验证码</label>
                                               <input type="text" placeholder="验证码" id="input5" />
                                               <img src="images/yzm.jpg" width="64" height="27" class="yzmimg" />
                                               <div class="clears"></div>
                                           </div>-->


                                           <div class="messsub">
                                               <input type="button" value="提交" onclick="addSmMessage()" style="background:#00a3eb;color:#fff;" />
                                               <input type="reset" value="重填" />
                                           </div>
                                       </form>

                                   </div>
                               </div>
                               <div>
                                   <input type="hidden" id="btn_query" value="刷新页面">
                                   <p style="color:#4500ff;font-size: 18px;">留言信息:</p><hr style="border: 1px solid #f37373">
                                   <div>
                                       <img src="../../images/message_sm.jpg" width="640px" height="280px">
                                   </div>
                               </div>
                           </div>
                       </div>

                       <div class="layui-tab-item">
                           <!--匿名留言-->
                           <div id="nmcontent">
                               <div class="wrap">
                                   <div style="height: 40px;margin-top: 10px;font-size: 16px;color: #b08329;">亲，请留言:</div>
                                   <div class="comment">
                                       <div class="content">
                                           <div class="cont-box">
                                               <textarea class="text" id='nmContent' placeholder="请输入..."></textarea>
                                           </div>
                                           <div style="color:red" id='nmError'></div>
                                           <div class="tools-box">
                                               <div class="operator-box-btn"><span class="face-icon"  >☺</span></div>
                                               <div class="submit-btn"><input type="button" onClick="addNmMessage()"value="提交留言" /></div>
                                           </div>
                                       </div>
                                   </div>
                                   <div>
                                       <p style="color:#5525d6;font-size: 16px;margin-top: 140px">留言信息:</p><hr style="border: 1px solid #f37373">
                                   </div>
                                   <div id="info-show">
                                       <ul id='messageXxInfo'></ul>
                                   </div>
                                   <!--分页-->
                                   <div id="fenye">
                                       <div id="demo7" style="margin: -2px 0 0 0;height: 50px"></div>
                                   </div>

                               </div>
                           </div>
                       </div>
                       <!------------nmend---------->
                   </div>

               </div>

           </div>
         </div>
         <!--end left -->
         <!--right-->
          <div class="right" id="c_right">
          <div class="s_about">
	          <h2>关于我<a href="about.jsp">更多>></a></h2>
	           <img class="person_tx" src="" width="230" height="230" alt="个人头像"/>
	           <p  class='person_name'></p>
	           <p class='person_work'></p>
	           <p class='person_address'></p>
	           <p>
	           <a target=blank href=tencent://message/?uin=1129896968&Site=lyg&Menu=yes><span class="left b_1"></span></a><a target="_blank" href="//shang.qq.com/wpa/qunwpa?idkey=9a9e02cd8b34796871514359bae9521d53a793fce9e46794b69d18b43fcf540c"><img border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="難忘的、壹天" title="難忘的、壹天"></a>
	           <div class="clear"></div>
	           </p>
          </div>
         <!--栏目分类-->
	        <div class="lanmubox">
	            <div class="hd">
	                <ul><li>精心推荐</li><li>最新文章</li></ul>
	            </div>
	            <div class="bd">
	                <ul id='jxtj'>
	                </ul>
	                <ul id='zxwz'>
	                </ul>
	            </div>
	        </div>
           <!--end-->
         </div>
         <!--end  right-->
         <div class="clear"></div>
         
    </div>
    <!--content end-->
    <!--footer-->
    <div id="footer">
       <p id="footLabel">The Boy Who Harnessed The Wind Liaoyuangui</p>
       <p id="footLabel1">联系方式:1129696968@qq.com</p>
    </div>


    <!--footer end-->
    <script type="text/javascript" src="../../js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="../../js/jquery.SuperSlide.2.1.1.js"></script>
	<script type="text/javascript" src="../../layui/layui.js"></script>
    <script type="text/javascript">jQuery(".lanmubox").slide({easing:"easeOutBounce",delayTime:400});</script>
    <script  type="text/javascript" src="../../js/nav.js"></script>
    <script type="text/javascript" src="../../js/message.js"></script>
    <script type="text/javascript" src="../../js/showPage/main.js"></script>
    <script type="text/javascript" src="../../js/showPage/sinaFaceAndEffec.js"></script>
    <script type="text/javascript" src="../../js/content/content.js"></script>
    <script type="text/javascript" src="../../js/content/theme.js"></script>
    
    <script>
	     //获取个人信息
	     getPersonInfo();  
	     //查询推荐的文章
	     getTjArticles();
	     //查询最新的文章
	     getNewArticles();
    </script>
       <script type="text/javascript">
           $("#btn_query").click(function(){
        	  // location.replace(document.referrer); //返回并刷新当前页面
        	   location.replace(location.href);
           })
      </script>
      
      <script>
          var utilExt,layer,laypage;
  		  layui.config({
  			base : '../../js/unit/'
  		 });
          layui.use(['element','laypage', 'utilExt','layer'], function(){
              var $ = layui.jquery
              ,element = layui.element; //Tab的切换功能，切换事件监听等，需要依赖element模块
              laypage = layui.laypage
                      ,layer = layui.layer;
              utilExt = layui.utilExt;
              //查询所有的匿名留言
              isNmMessage();
          });
              function  isNmMessage(){
              	 $.ajax({
              		 url:"../../message/selectAllMessage.do", 
     	       		 data:{"isNm":1},
     	       		 type:"post",
              		success:function(data){
              			  //分页完整功能
                          if(data.length>15){
             			    	//调用分页
             					  laypage.render({
             					    elem: 'demo7'
             					    ,count: data.length
             					    ,limit:'15'
             					    ,layout: ['count', 'prev', 'page', 'next',  'skip']
             					    ,jump: function(obj){
             					      //模拟渲染
             					      document.getElementById('messageXxInfo').innerHTML = function(){
             					        var arr = []
             					        ,thisData = data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
             					        layui.each(thisData, function(index, item){
             					          arr.push("<li>"+
             					        		  '<div class="head-face">'+
             		        		              '<img src="'+item.userTx+'" / >'+
             		        		              '</div>'+
             		        		              '<div class="reply-cont">'+
             		        		              '<p class="username">'+item.userNickname+'</p>'+
             		        		              '<p class="comment-body">'+item.content+'</p>'+
             		        		              '<p class="comment-footer">'+item.addTime+'</p>'+
             		        		              '</div>'+
             	      	     			    "</li>");
             					        });
             					        return arr.join('');
             					      }();
             					    }
             					  });
             			    }else{
             			        var str = ""; 
             			        if(data.length==0){
          	     				str = "<tr colspan='5'>暂无数据</tr>";
          	     			}else{
          	     				 var  html="";
          	        			$.each(data,function(index,item){
          	        				if(item.pid==0){
          	        					html  += '<li>'+
          		        		              '<div class="head-face">'+
          		        		              '<img src="'+item.userTx+'" / >'+
          		        		              '</div>'+
          		        		              '<div class="reply-cont">'+
          		        		              '<p class="username">'+item.userNickname+'</p>'+
          		        		              '<p class="comment-body">'+item.content+'</p>'+
          		        		              '<p class="comment-footer">'+item.addTime+'</p>'+
          		        		              '</div>'+
          		        		              '</li>';
          	        				}
          	        			});
                	     			
                	     		}
             			        $('#info-show ul').html(html);
             	    			
             			    }

              		}
              	 });
               }
          
          
        //插入实名留言
          function addSmMessage(){
          	var flag  =  send();
          	if(flag==false){
          		return;
          	}
          	//向数据库中插入数据
          	var name = document.getElementById("input1").value;
  	        var mail = document.getElementById("input2").value;
  	        var phone = document.getElementById("input3").value;
  	        var content = document.getElementById("input4").value;
          	var data = {"name":name,"email":mail,"phone":phone,"content":content}
          	console.log(data)
              $.ajax({
              	url:"../../message/insertSmMessage.do",
              	data:data,
              	type:"post",
              	success:function(res){
              		console.log(res)
              		if(res>0){
              			utilExt.successMsg("留言成功，感谢您的关怀！！！", function() {
							//layer.closeAll();
							$("#btn_query").click();
						});
              		}else{
              			utilExt.successMsg("留言失败，请刷新后重试！！！");
              		}
              	}
              });
          }
        
        
      </script>
      <script type="text/javascript">
          // 绑定表情
          $('.face-icon').SinaEmotion($('.text'));
          // 测试本地解析
          function addNmMessage() {
        	  var content = $("#nmContent").val();
        	  if(content.trim()==""){
        		  $("#nmError").html("请输入内容...");
        		  $("#nmContent").focus();
        		  return;
        	  }else{
        		  $("#nmError").html("");
        	  }
        	  $.ajax({
        		  url:"../../message/checkLogin.do",
        		  type:"post",
        		  success:function(res){
        			  if(res.result=='0'){
        				  utilExt.errorMsg("请先登录！！！");
        				  return;
        		         /*  end  */
        			  }else{
        				  //插入数据
        				  content = AnalyticEmotion(content);
        				  var data={"content":content}
        				  $.ajax({
        					  url:"../../message/insertNmMessage.do",
        					  data:data,
        					  type:"post",
        					  success:function(res){
        						  if(res>0){
        							  utilExt.successMsg("留言成功！！！", function() {
        									layer.closeAll();
        									 isNmMessage();
        								});
        						  }else{
        							  utilExt.errorMsg("留言失败，请刷新后重试！！！");
        						  }
        					  }
        				  })
        				  //var inputText = $('.text').val();
        	             // $('#info-show ul').append(reply(AnalyticEmotion(inputText)));
        			  }
        		  }
        	  })
          }

       
          function isNmMessages(){
        	  $.ajax({
        		 url:"../../message/selectAllMessage.do", 
        		 data:{"isNm":1},
        		 type:"post",
        		 success:function(res){
        			 var  html="";
        			$.each(res,function(index,item){
        				if(item.pid==0){
        					html  += '<li>'+
	        		              '<div class="head-face">'+
	        		              '<img src="'+item.userTx+'" / >'+
	        		              '</div>'+
	        		              '<div class="reply-cont">'+
	        		              '<p class="username">'+item.userNickname+'</p>'+
	        		              '<p class="comment-body">'+item.content+'</p>'+
	        		              '<p class="comment-footer">'+item.addTime+'</p>'+
	        		              '</div>'+
	        		              '</li>';
        				}
        			});
        			 $('#info-show ul').html(AnalyticEmotion(html));
        		 }
        	  });
          }
/* ------------------------------------------- */
          
         
      </script>

</body>
</html>

